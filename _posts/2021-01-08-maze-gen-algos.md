---
layout: post
title: "Experimenting with Maze Generation Algorithms"
date: 2021-01-08
blurb: Terraria Zeus Expansion Mod Devlog
---

##### So I did some experimentation with maze generation algorithms to add a Labyrinth in my collaborative Terraria mod.

Greek Mythology is cool. For the last week or so, I've been collaborating with [raghav198](https://www.github.com/raghav198) (a.k.a. quaternion) to create a mod for Terraria that adds elements of Greek Mythology to the game (hence the name "Zeus Expansion"). As one of these additions, we decided to incldue a Labyrinth, the twisting underground maze that houses the Minotaur. Rather than having a hard-coded maze, we decided to use a maze-generation algorithm that would create a different Labyrinth for every world.

### General Idea

Consider a 10x10 grid that represents our maze:  
![blank 10x10 grid](/img/maze_gen_algos/01.png)

We'll randomly pick a seed tile at the top and go from there:  
![seed tile](/img/maze_gen_algos/02.png)

After we've created the seed tile, we'll start keeping track of all the new tiles we've opened up in the maze so far. Once we have a seed tile, we will select a random number of available adjacent tiles to also open up (say, 2 of the 3; seed tile is blue):  
![adjacent tiles](/img/maze_gen_algos/03.png)

Now, with the new tiles we've just opened up, we repeat the same process and open up a random number of the adjacent tiles. We continue until we have no more tiles to open. And, just like that, we have a maze!

### Implementation
Most Terraria mods are written in C#, and this is no exception. First, let's start setting up the actual method that will do the maze generation.

By looking at the header:

```csharp
static int[,] genMaze(int width, int height, int topSeed)
```

...you can see that we'll be taking in a `width`, a `height`, and the number tile that will be the `topSeed`.

To start, we need to set up a few variables. The random number generator:

```csharp
Random rand = new Random();
```

The frontier list that will keep track of which tiles we just opened up:

```csharp
List<int[]> frontier = new List<int[]>();
```

And, of course, the maze itself:

```csharp
int[,] maze = new int[height, width];
```

Next, we set all of the maze's tiles as closed (0) to begin with. Over the course of the method, we will open up more tiles:

```csharp
for (int i = 0; i < height; i++)
    for (int j = 0; j < width; j++)
            maze[i, j] = 0;
```

Now, for the actual maze generation. Of course, we need to start by opening up the top seed and adding it to the frontier list:

```csharp
maze[0, topSeed] = 1;
frontier.Add(coord(0, topSeed));
```

Once the frontier list has been started, we need to loop over it until it's empty.

```csharp
while (frontier.Count > 0)
{
    ...
}
```

As a helper, I created a simple `checkAdjEmpty` method, which returns which of the four adjacent tiles are empty:

```csharp
static List<int[]> adjEmpty(int[,] array, int[] coord)
{
    List<int[]> newArr = new List<int[]>();
    int x = coord[0];
    int y = coord[1];
    for (int i = -1; i <= 1; i++)
        for (int j = -1; j <= 1; j++)
        {
            try
            {
                if (array[x + i, y + j] == 0 && Math.Abs(i + j) == 1) newArr.Add(new int[] { x + i, y + j });
            }
            catch (System.IndexOutOfRangeException) { }
        }
    return newArr;
}
```

The next bit of code gets the coordinates and selects the random number of tiles we'll be opening up:

```csharp
List<int[]> poss = adjEmpty(maze, frontier[0]);
frontier.Remove(frontier[0]);
if (poss.Count == 0) continue;
int num = rand.Next(1, poss.Count + 1);
```

Then, we pick some random tiles from the list of possible tiles, and the ones that work are opened up. We add these newly-opened tiles to the frontier list and repeat the process over again.

```csharp
for (int i = 0; i < num; i++)
{
    int[] coord = poss[rand.Next(0, poss.Count)];
    if (adjEmpty(maze, coord).Count == 3)
    {
        maze[coord[0], coord[1]] = 1;
        frontier.Add(coord);
    }
    poss.Remove(coord);
}
```

We have a maze generator... almost!

### Results
Here's an example maze we can get from the generator: (pretty neat, eh?)

```
########################################### ########################################################
###################  ############ ####         #   ## ## ###### # # ################################
#################### ###########   ## # # # # ### ###      ###      ################################
########### ########   ########## #      # ##      ## ## #  # # ## #################################
##########   ####### ###### ####    # # ##    ## #     #  #       ##################################
######## # #######     ##     ### #  ### ## # #  ## # #  ## # ### ##################################
########    #####  # #   # # ## #  ## #   # # ## # #####  #  #     #################################
##### ## # ### # # ##  # #  #   ##      ##   ###    ### # # ### # # ################################
###       ####      #####  ####   ### # ### #    # # #   ## ### #    ###############################
### ## # # #### # #   ### # #   ##    # ###### # #    ## ##  ##### # ###############################
# # ###     ###  ### #        # # # # # #########  # ##  ###   ####   ##############################
#    ### # ### ## ##   # # ## #     # #  ##########   # # # # #### # # #### ########################
### #### #####      ## # #   ############# ######### #        # #       ##    ######################
##    #       # # ## #  ## ###  #  #### #   ### #####  ### # #   # # ##   # ########################
# # # #### ## # #      ## ## ## # # ### # ### #  #####    ######    #### ## # ######################
#    ## # #      ## # ##        #               # #    ########### #####  #    #####################
### #      ## # ### #### ## # ##  # ### ## # # #   ## ###  ############## # # ######################
###  ### #   # # # ####  ###  ## # # # #### #   # ### ##  ##### ########     # #####################
##  #  ## ##   #     # # ######          #    ###  #   # # ## #  ###### ## #   #####################
# #  #      ##   # #   #  #### # # # ### ####   ## ## #     #   ######    ## #######################
#   #  ### #   #  #  #   # #     ####     # # #     # ## # # # # ###  ## # # #######################
###   ####  # ## #  #  #   ## # # ## ## ##   #  ## #      ##         #        ######################
#### ###### # ### #  ### ####  #   #      # # #   #  # # #### # # ##  ## ### # # ###################
##########     #    #####  #### # ### # # #     #  ##   #### ## ##  # #  #        ##################
########### ##### # #### #         # #   #  ###  ##### ####   #    #  ###### ### # #################
#   ######    #####  #     ## # # #    ####  #### ## ###### # ### ###  ###   ###   #################
# # ## #### # ######## ## ##  ## ### # #### ###    #   #### ##     ## # ### ##### ##################
##     ## #  # #########  # # #  #####  ## ###  # # ##  ###   # # ##    ### ## # ###################
### ##      #   #########    # #  ##   #    #  #     # ###  #    #### #   # #      #################
####### ###  # ############ #    # # #### #   # ### #    ## ###### #  ###  # # # #  ############ ###
######## # #    ########### ## #      #   ### #      # ##          ##  #  #    ####  ##########    #
########   # # # #########     # ### #  #    #  # # #   # # ######## #  # ## #  ### # ########## # #
######## #  #     #### ##  # #  #      ## # ###  ### # #############   #   # # #  #   #########   ##
###### # # ### # # ##    # ### # ### # #  #    #        ############ #  # # #### # ##  ######   # ##
######    #####      # #  #    # ####  ##### ##  # ### ##################   ###      # # ###  #  ###
###### # ####### # #    ##  ##    ## ##  ### # #  ##  ##################  ###### # ##      ##  #####
#####  # ######   ### # #####  # #    ##  #  #   ##  ##############  ####   ######    ####    ######
#### #  # ## # # #####  ###  ## #### ### # ##  # # #   ###########  # ### ## ##### # ###### ########
###   #          ######     # #      ### #   #  ##  ## ##########  #   #  #   # # #   ## #    ######
## # ### # ## # ####### ## #    # #####   ## # ##  ###  ########  ### # #   #       ##     # #######
#  #  ###    # ######## #   ### # #  # # # #    ## ##  ####### # # #      # # # # ## #####  ## #####
##   # # ###     ######### #     # # #   #   # #   # #  # ###        ### ## #  ####        ##   # ##
#  #        # # ##########   ###       # # ##  ### #   #   # # # ## ###  ## # #     #### #  # #    #
## # # # ###  # ########### ## # # # ##  #####      # #### #    ##    ###    ##### #     ## #  ## ##
#  #  # #### ################# ##   # ##  # # # # ##   ##    # ### ## ### # ######### # ###   # #  #
##  ##     # ###  ############   # #    ##    # # ### ##  # ## ##  # ######  #####     ##### #   # #
## #### ##   ### ############  # #  # # #####   # # # #######    # #  ############# # ######   # # #
## ##    ###  #   ########### #### ## # #### # #        # # ## ##  ##  ###########   # ###### ### ##
#     # #### # # ###########       #  ######   ## # # #       # # ## #  ########## #    ########   #
## # #  #####     ## ######  ##### # ### ##  # ###   #  # ### # #      ############  # # ###### # ##
#  ##  ###### ## ##   ### ### # #  #  #    ###  # # ### #  # #  # ## #  #############     ###      #
## ###########   # # # #   #      ## ### # #####     #  ###    ### ##  ############# # # ###  # ####
#   #########  #         # ## # # #   #  # ####  # ### ##   # ##      ########## #      ## ##  #####
## # #####  # #  # # #### ###  ### ## # #    #  ####   #  # ##### # ###########    # # #    # # ####
## #  #####    #  #   ###     ###   #   # # # #  #  # ####  # ###  ############# #  ## # # #     ###
##   ######## #  #  # # # ## ###  # ### # #     # #   ##  #       # ############  #   ###    # #  ##
######## # #   ##  #  # # #   ### # ####   # # ##  ##    #### ### # #############  # # #  # #####  #
#######     ##  ### # #   ## ###   ###### ####    ##############  # ##############  #   # # ###### #
######## # # # #    #   #   # # # # # ##     ## #  ####  #### # #    ############# # # ## #  ####  #
#######   #    # # # ## ###              # #   ### #  # # ##      # #############          ## ## # #
######## ## ### #     ##### ### # ## ## ###  #    # #      # ### #    # ########## ## ## #  #      #
#######      #   # # # #########  #### #####  ## #    ### #  #  ### #    ##########  ### ##  # ### #
######## ## ### # #     ############ # ###   ##    # #    # ###  #   ###############  ###  ##  #  ##
#########    #     # # ### #########    #  #   # #### # ##      #### ### ########### # ## ##  #  ###
########## #### # ###   #  ######### # ## ## ###### #     # ###  # # #     ## ####          #   ####
################  # ### # ######## # ##### # # #      # ##### ##    #  # # #  #### # # # # ## # ####
#################          ######     ###   #    # ####   #     # #   #  ### # ##  # ####   ##    ##
################## # # # # ###   # # # # # # ####  ##### # ### #   ##  #####     ## ## # # ##### ###
################   #  ###      #    #           # ###  #    #    ###  ###### # # #         ### # ###
###############  ##  ##### ### # # ## ## # # # ### #  # # #  # #   ##  ##   # #    ## # ####     ###
################ ###  #########   ##   ####  # #   # #     ###### ### #   #     ## #   ####  #######
################### ## # ##### # #  ## #####  #  #    # # ## ### # #   # # # # # # ###  ### ## #####
##################   #    ###  #   ##   #### ### ## #  #      ##     # ##     #     #  #### #   ####
################### #  # # # # ### # # # #### # #    ##  # # ##  # # # ## # #### # #  ##### ## #####
##################    #          #        ##      # #  # ##    # ## #  #   #   #  #### ## #     ####
#################### # # # # # ##  # # # ## # # ##    # ######      # #### # ## #    #      # ######
####################    ###  #  # ###   ##     #   ##        # ####  ####       # ##   # # #  ######
##################### #    #  #    # # #  # # ## ### ## ## ##  #####   # # # # # #  #### ### #######
######################## ### #  # #      #####    #   # #  ## #####  #    ###      #   #    ########
#######################   #   #### # ## ######## #  #   ###  # ##### ## #  ### # # # # # ## ########
######################## #  # # #     ########  #  ## # #   ##  #### ###  #######  ##     ##########
############################     ### ######## # ##  ##    #    ####  #  #  ####   #### # ###########
###########################  # #   #########    # # ### # ## # ### #  #   ##  ## ###################
#########################  #  ### # # ####### #     ###  # # #  ## # ## ## # #######################
##########################   # #       ####    # ## ####   ##  # # # # #      ######################
########################## #   ## # ## #### # ###    #   ##   #          ## ########################
#########################   ##   ## ###  #   ### # ##  ## # #   # ## # # ###########################
############################# ### #   ## ## ##     ### #    # # #   ################################
######################## # #   #    # ## #  #### # ### ### # #  ####################################
#######################      ##  ## ##     #      ####  #### # #  ##################################
######################## ###    # ##### # ## # # # ## #  ###     ###################################
############################# #     ##   ##  ##  #      ##### ######################################
############################### # # ### ### #   ## # # #############################################
##############################   #   # ### #  # ##  ################################################
############################### #  #        # #   ##################################################
##################################  ## # ##    # ###################################################
#################################  ######### #######################################################
################################ #     ####  #######################################################
###############################    #################################################################
####################################################################################################
```

But then, we can also get this one:

```
################################################################################ ###################
################################################################################   #################
################################################################################ ###################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
```

It's always possible that the random numbers (or the number of viable tiles) will end up being 0 and the generation will stop prematurely. To prevent that, I added a small piece of code in my tester method that only returns the maze if 42% or more of it is empty tiles (I'm generating 100x100 mazes). Once I do this, the mazes I get are much nicer.

Enjoy some mazes using square fonts: :):)

![good maze 1](/img/maze_gen_algos/04.png)

![good maze 2](/img/maze_gen_algos/05.png)

![good maze 3](/img/maze_gen_algos/06.png)

